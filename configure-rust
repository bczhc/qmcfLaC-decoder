#!/bin/groovy

def selfDir = new File(getClass().protectionDomain.codeSource.location.path).parentFile
metaClass.mixin new GroovyScriptEngine(selfDir.canonicalPath).with {
    loadScriptByName('lib.groovy')
}

def target = "aarch64-linux-android"
def targetList = "rustup target list".execute().text.split("\\n").toList()
def installed = false
targetList.forEach {
    if (it.matches("^$target( \\(installed\\))?\$")) {
        if (it.matches(".*installed\\)\$")) {
            installed = true
        }
    }
}
if (!installed) {
    runShell(["rustup", "target", "add", target])
}

